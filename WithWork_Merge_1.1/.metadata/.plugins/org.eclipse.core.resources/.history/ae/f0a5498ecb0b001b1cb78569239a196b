<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!DOCTYPE html>
<html>
<head>
    <%@ include file="include/mainHead.jsp" %>
    
    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
    <script src="https://apis.google.com/js/platform.js?onload=init" async defer></script>
    <script src="js/nav.js"></script>
</head>
<style>
	.addedR, addedD {
		cursor: pointer;
	}
</style>
<body>
	<%@ include file="include/nav.jsp" %>
	<form id="signup" action="insertGroup.do" method="post">
		<div class="mainInner">
			<div class="innerTit">
				<dl>
					<dt>협업을 위한 그룹을 생성해보세요.</dt>
					<dd>withWork의 회원이라면 누구든 그룹을 생성할 수 있습니다.</dd>
				</dl>
			</div>
	        <table class="mainTableForm">
	        	<colgroup>
	        		<col width="20%"/>
	        		<col width="70%"/>
	        	</colgroup>
	        	<tr>
	        		<th>그룹 이름</th>
	        		<td>
			            <input type="text" id="groupName" name="name" placeholder="그룹이름을 입력하세요.">        		
	        		</td>
	        	</tr>
	        	<tr>
	        		<th>그룹 테마</th>
	        		<td>
			            <input type="text" id="groupSub" name="subject" placeholder="그룹주제를 입력하세요.">        		      		
	        		</td>
	        	</tr>
	        	<tr>
	        		<th rowspan="2">부서</th>
	        		<td id="departResult"></td>
	        	</tr>
	        	<tr>
	        		<td>
	        			<input type="text" id="addD" placeholder="부서를 입력하세요">
	        			<button type="button" class="defaultBtn addD">추가</button>
        			</td>
	        	</tr>
	        	<tr>
	        		<th rowspan="2">직책</th>
	        		<td id="roleResult"></td>
	        	</tr>
	        	<tr>
	        		<td>
	        			<input type="text" id="addR" placeholder="직책을 입력하세요">
	        			<button type="button" class="defaultBtn addR">추가</button>
        			</td>
	        	</tr>
	        </table>
	        <div class="navBtn">
	            <input type="hidden" name="email" value="${sessionScope.email }">
	            <button class="defaultBtn insertGroup">그룹 생성</button>
	        </div>
		</div>
    </form>
</body>
<script>

	/* enter key 막기*/
	$('input[type="text"]').keydown(function() {
		if (event.keyCode === 13) {
			event.preventDefault();
		};
	});

	$(".addR").on("click", function(e){
		addRVal = $("#addR").val();
		console.log('addRVal : ' + addRVal);
		
		if(addRVal == '') {
			alert("값을 입력해주세요.");
			return;
		}
		
		roleHtml = $("#roleResult").html();
		
		if($("#roleResult").html() == '') {
			roleHtml += '<span class="addedR">'+addRVal+'</span>';
		} else {
			roleHtml += '<span class="addedR">, '+addRVal+'</span>';
		}
		
		$("#roleResult").html(roleHtml);
		$("#addR").val('');
	});
	
	$(document).on("click", ".addedR", function(){
		
		$(this).remove();
	});
	
	
	$(".addD").on("click", function(e){
		addDVal = $("#addD").val();
		console.log('addDVal : ' + addDVal);
		
		if(addDVal == '') {
			alert("값을 입력해주세요.");
			return;
		}
		
		departHtml = $("#departResult").html();
		
		if($("#departResult").html() == '') {
			departHtml += '<span class="addedD">'+addDVal+'</span>';
		} else {
			departHtml += '<span class="addedD">, '+addDVal+'</span>';
		}
		
		$("#departResult").html(departHtml);
		$("#addD").val('');
	});
	
	$(document).on("click", ".addedD", function(){
		
		$(this).remove();
	});
	
	$(".insertGroup").on("click", function(e){
		
		e.preventDefault();
		
		name = $("#groupName").val();
		subject = $("#groupSub").val();
		var departArr = '';
		var roleArr = '';
		
		$("#departResult").each(function(){
		    departArr = $(this).find("span").text();
		});
		$("#roleResult").each(function(){
		    roleArr = $(this).find("span").text();
		});
		
		console.log('name : ' + name);
		console.log('subject : ' + subject);
		console.log('departArr : ' + departArr);
		console.log('roleArr : ' + roleArr);
		
		
		$.ajax({
			url: '/insertGroup.do',
			data: 'name='+name+'&subject='+subject+'&role='+roleArr+'&depart='+departArr,
			success: function(data){
				console.log('success : ' + data);
			},
			error: function(error) {
				alert("error:"+error);
			}
		});
		
	});
</script>
</html>